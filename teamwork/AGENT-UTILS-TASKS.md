# üîß AGENT-UTILS: Utilities & Services

**Agent Assignment**: Utilities, Services & Helper Functions Testing  
**Mission**: Achieve 100% test coverage for all utility functions and services  
**Status**: READY TO START  

## üéØ UTILITIES RESPONSIBILITIES

You are responsible for **foundation utilities** that power the entire framework. These pure functions and services are used everywhere and must be rock-solid reliable.

## üìÇ FILES TO TEST (Priority Order)

### Priority 1: Fix Failing Color Tests (CRITICAL)
```
src/utils/colors/ - Currently 89% coverage, FAILING TESTS
‚îú‚îÄ‚îÄ color.ts              (Named color support - FAILING)
‚îú‚îÄ‚îÄ rgb.ts                (RGB color functions - FAILING)  
‚îú‚îÄ‚îÄ hex.ts                (Hex color functions - FAILING)
‚îú‚îÄ‚îÄ bgRgb.ts              (Background RGB - working)
‚îú‚îÄ‚îÄ bgHex.ts              (Background hex - working)
‚îú‚îÄ‚îÄ reset.ts              (Reset colors - working)
‚îú‚îÄ‚îÄ index.ts              (Color exports - working)
‚îî‚îÄ‚îÄ types.ts              (Color types - working)
```

**Current Failures**:
- RGB values not clamped (300, -10 should become 255, 0)
- Decimal RGB values not rounded
- 3-digit hex codes not expanded properly  
- Invalid hex codes not defaulting to black
- Named colors returning empty strings instead of ANSI codes

### Priority 2: Complete Style Functions  
```
src/utils/styles/ - Currently 65% coverage
‚îú‚îÄ‚îÄ style.ts              (Style combinations - 33% coverage)
‚îú‚îÄ‚îÄ blink.ts              (Blink style - 50% coverage)
‚îú‚îÄ‚îÄ bold.ts               (Bold style - 50% coverage)
‚îú‚îÄ‚îÄ dim.ts                (Dim style - 50% coverage) 
‚îú‚îÄ‚îÄ italic.ts             (Italic style - 50% coverage)
‚îú‚îÄ‚îÄ reverse.ts            (Reverse style - 50% coverage)
‚îú‚îÄ‚îÄ strikethrough.ts      (Strikethrough - 50% coverage)
‚îú‚îÄ‚îÄ underline.ts          (Underline - 50% coverage)
‚îú‚îÄ‚îÄ hidden.ts             (Hidden text - 50% coverage)
‚îú‚îÄ‚îÄ centerText.ts         (Text centering - 20% coverage)
‚îú‚îÄ‚îÄ truncate.ts           (Text truncation - 25% coverage)
‚îú‚îÄ‚îÄ drawBox.ts            (Box drawing - 16% coverage)
‚îú‚îÄ‚îÄ boxStyles.ts          (Box styles - 100% ‚úì)
‚îî‚îÄ‚îÄ types.ts              (Style types - 100% ‚úì)
```

### Priority 3: Zero Coverage Utilities (CRITICAL)
```
src/utils/platform.ts    - 0% COVERAGE - Platform detection functions
src/utils/services.ts     - 0% COVERAGE - Service management system
```

### Priority 4: State Management System
```
src/core/StateManager/ - Complex state system
‚îú‚îÄ‚îÄ Store.ts              (Main store container)
‚îú‚îÄ‚îÄ constructor.ts        (Store initialization)
‚îú‚îÄ‚îÄ state.ts              (State management)
‚îú‚îÄ‚îÄ mutations.ts          (State mutations)
‚îú‚îÄ‚îÄ actions.ts            (Async actions)
‚îú‚îÄ‚îÄ getters.ts            (Computed values)
‚îú‚îÄ‚îÄ gettersGet.ts         (Getter retrieval)
‚îú‚îÄ‚îÄ watch.ts              (State watching)
‚îú‚îÄ‚îÄ watchers.ts           (Watcher management)
‚îú‚îÄ‚îÄ reactive.ts           (Reactive system)
‚îú‚îÄ‚îÄ subscribe.ts          (Store subscription)
‚îú‚îÄ‚îÄ subscribeAction.ts    (Action subscription)
‚îú‚îÄ‚îÄ dispatch.ts           (Action dispatch)
‚îú‚îÄ‚îÄ commit.ts             (Mutation commit)
‚îú‚îÄ‚îÄ snapshot.ts           (State snapshots)
‚îú‚îÄ‚îÄ restore.ts            (State restoration)
‚îú‚îÄ‚îÄ replaceState.ts       (State replacement)
‚îú‚îÄ‚îÄ trackChange.ts        (Change tracking)
‚îú‚îÄ‚îÄ trackDependency.ts    (Dependency tracking)
‚îú‚îÄ‚îÄ triggerWatchers.ts    (Watcher triggers)
‚îú‚îÄ‚îÄ timeTravel.ts         (Time travel debugging)
‚îú‚îÄ‚îÄ getHistory.ts         (History retrieval)
‚îú‚îÄ‚îÄ clearHistory.ts       (History clearing)
‚îî‚îÄ‚îÄ registerModule.ts     (Module registration)
```

### Priority 5: Store Management
```
src/core/StoreManager/ - Store management system  
‚îú‚îÄ‚îÄ StoreManager.ts       (Container - store management)
‚îú‚îÄ‚îÄ constructor.ts        (Manager initialization)
‚îú‚îÄ‚îÄ createStore.ts        (Store creation)
‚îú‚îÄ‚îÄ getStore.ts           (Store retrieval)
‚îú‚îÄ‚îÄ get.ts                (Value getting)
‚îú‚îÄ‚îÄ set.ts                (Value setting)
‚îú‚îÄ‚îÄ destroy.ts            (Store cleanup)
‚îú‚îÄ‚îÄ getState.ts           (State access)
‚îú‚îÄ‚îÄ initializeState.ts    (State initialization)
‚îú‚îÄ‚îÄ registerGlobalStore.ts (Global store)
‚îú‚îÄ‚îÄ subscribe.ts          (Store subscription)
‚îú‚îÄ‚îÄ mutations.ts          (Mutation management)
‚îú‚îÄ‚îÄ actions.ts            (Action management)
‚îî‚îÄ‚îÄ getters.ts            (Getter management)
```

### Priority 6: Theme System
```
src/core/Theme/ - Theming system
‚îú‚îÄ‚îÄ ThemeManager.ts       (Container - theme management)
‚îú‚îÄ‚îÄ themes.ts             (Theme definitions)
‚îú‚îÄ‚îÄ colorPalettes.ts      (Color palettes)
‚îú‚îÄ‚îÄ borderStyles.ts       (Border styling)
‚îú‚îÄ‚îÄ spacing.ts            (Spacing definitions)
‚îî‚îÄ‚îÄ index.ts              (Theme exports)
```

## üß™ TESTING STRATEGY

### 1. Fix Failing Color Tests FIRST
```javascript
// Current failing test pattern (NEEDS FIXING):
describe('RGB Colors', () => {
  it('should clamp RGB values', () => {
    const result = rgb(300, -10, 128);
    // FAILING: expects '\x1b[38;2;255;0;128m'
    // GETTING: '\x1b[38;2;300;-10;128m'
    expect(result).toBe('\x1b[38;2;255;0;128m');
  });
});

// SOLUTION NEEDED: Fix rgb.ts to clamp values 0-255
```

### 2. Pure Function Testing Pattern
```javascript
// Utility functions are pure - easy to test
describe('UtilityFunction', () => {
  test('should return expected output for given input', () => {
    const result = utilityFunction(input);
    expect(result).toBe(expectedOutput);
  });
  
  test('should handle edge cases', () => {
    expect(utilityFunction(null)).toBe(defaultValue);
    expect(utilityFunction(undefined)).toBe(defaultValue);
    expect(utilityFunction('')).toBe(emptyResult);
  });
});
```

### 3. Service Testing Pattern
```javascript
// Services often use singleton pattern
describe('ServiceName', () => {
  beforeEach(() => {
    // Reset singleton state between tests
    ServiceName.getInstance().reset();
  });
  
  test('should provide singleton instance', () => {
    const instance1 = ServiceName.getInstance();
    const instance2 = ServiceName.getInstance();
    expect(instance1).toBe(instance2);
  });
});
```

### 4. State Management Testing
```javascript
// State management needs careful testing
describe('Store', () => {
  let store;
  
  beforeEach(() => {
    store = new Store({
      state: { count: 0 },
      mutations: {
        increment: (state) => state.count++
      }
    });
  });
  
  test('should handle mutations', () => {
    store.commit('increment');
    expect(store.state.count).toBe(1);
  });
});
```

## üìã SPECIFIC TASKS

### Task 1: Fix Color System (Day 1 - CRITICAL)
- [ ] **FIX** `rgb.ts` - add value clamping (0-255)
- [ ] **FIX** `rgb.ts` - round decimal values  
- [ ] **FIX** `hex.ts` - proper 3-digit hex expansion
- [ ] **FIX** `hex.ts` - invalid hex defaults to black
- [ ] **FIX** `color.ts` - implement named color mapping
- [ ] **VERIFY** all color tests pass
- [ ] **ACHIEVE** 100% color coverage

### Task 2: Complete Style System (Day 1-2)
- [ ] Test all style functions individually
- [ ] Test style combination logic
- [ ] Test `centerText.ts` - text centering algorithm
- [ ] Test `truncate.ts` - text truncation logic  
- [ ] Test `drawBox.ts` - box drawing functions
- [ ] Create comprehensive style integration tests
- [ ] Achieve 100% style coverage

### Task 3: Platform & Services (Day 2-3)
- [ ] **CREATE** comprehensive `platform.ts` tests
  - [ ] Operating system detection
  - [ ] Terminal capability detection
  - [ ] Environment variable handling
- [ ] **CREATE** comprehensive `services.ts` tests  
  - [ ] Service registration/discovery
  - [ ] Service lifecycle management
  - [ ] Dependency injection system
- [ ] Achieve 100% platform/services coverage

### Task 4: State Management (Day 3-4)
- [ ] Test `Store.ts` container class delegation
- [ ] Test all state management method files
- [ ] Test reactive state updates
- [ ] Test mutation and action systems
- [ ] Test state watching and subscriptions
- [ ] Test time travel debugging
- [ ] Test snapshot and restore functionality
- [ ] Achieve 100% StateManager coverage

### Task 5: Store Management (Day 4-5)
- [ ] Test `StoreManager.ts` singleton pattern
- [ ] Test store creation and cleanup
- [ ] Test global store registration
- [ ] Test store value getting/setting
- [ ] Test store subscription system
- [ ] Integration with StateManager
- [ ] Achieve 100% StoreManager coverage

### Task 6: Theme System (Day 5)
- [ ] Test `ThemeManager.ts` container
- [ ] Test theme switching and application
- [ ] Test color palette system
- [ ] Test border and spacing systems
- [ ] Test theme inheritance and overrides
- [ ] Achieve 100% Theme coverage

## üìä SUCCESS CRITERIA

### Coverage Targets:
- **Color Functions**: 89% ‚Üí 100% (fix failing tests)
- **Style Functions**: 65% ‚Üí 100% 
- **Platform Utils**: 0% ‚Üí 100% (critical)
- **Services**: 0% ‚Üí 100% (critical)
- **State Management**: 0% ‚Üí 100%
- **Store Management**: 0% ‚Üí 100%
- **Theme System**: 0% ‚Üí 100%

### Quality Gates:
- [ ] All failing color tests are fixed and green
- [ ] All utility functions have comprehensive tests
- [ ] Service singletons properly tested
- [ ] State management thoroughly covered
- [ ] Edge cases and error conditions tested
- [ ] Zero TypeScript errors
- [ ] All tests are green and stable

## ü§ù COORDINATION POINTS

### Provide to Other Agents:
- **Fixed color functions** ‚Üí Agent-Components needs for UI styling
- **Platform detection** ‚Üí Agent-Core needs for terminal operations
- **Service patterns** ‚Üí All agents need service testing patterns
- **State management** ‚Üí Agent-Integration needs for complex workflows

### Use from Agent-Core:
- **Base testing patterns** ‚Üí For consistent testing approach
- **Mock utilities** ‚Üí For process and environment mocking

### Coordinate with Agent-Components:
- **Style functions** ‚Üí Components need styles for theming
- **Color functions** ‚Üí Components need colors for appearance

## üö® CRITICAL FIXES NEEDED

### Failing Color Tests (MUST FIX FIRST):
1. **RGB Clamping**: Values > 255 or < 0 must be clamped
2. **RGB Rounding**: Decimal values must be rounded to integers
3. **Hex Expansion**: 3-digit hex (#F00) ‚Üí 6-digit (#FF0000)
4. **Hex Validation**: Invalid hex ‚Üí default to black (#000000)
5. **Named Colors**: Empty strings ‚Üí proper ANSI codes

### Example Fix for `rgb.ts`:
```javascript
// BROKEN:
export function rgb(r: number, g: number, b: number): string {
  return `\x1b[38;2;${r};${g};${b}m`;
}

// FIXED:
export function rgb(r: number, g: number, b: number): string {
  const clamp = (val: number) => Math.max(0, Math.min(255, Math.round(val)));
  return `\x1b[38;2;${clamp(r)};${clamp(g)};${clamp(b)}m`;
}
```

## üìù PROGRESS TRACKING

Update daily in your individual agent file:

```markdown
## Daily Progress - Agent-Utils

### Day 1: [Date]
- ‚úÖ Fixed ALL failing color tests 
- ‚úÖ RGB clamping and rounding implemented
- ‚úÖ Hex validation and expansion fixed
- üîÑ Color coverage: 100% (was 89%)

### Day 2: [Date]
- ‚úÖ Completed all style functions
- ‚úÖ Started platform detection tests  
- üìã Next: Services system testing
- üîÑ Utils coverage: 67%
```

## üéØ FINAL DELIVERABLES

When Agent-Utils work is complete:
- [ ] 100% test coverage for all utility modules
- [ ] ALL failing tests fixed and green
- [ ] Comprehensive service testing patterns
- [ ] State management test examples
- [ ] Utility test library for other agents
- [ ] Zero critical utility bugs

**Your success provides the rock-solid foundation every other part of the framework depends on! üîß‚ö°**